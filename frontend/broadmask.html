<!DOCTYPE html>
<head>
	<link rel="stylesheet" href="css/bootstrap.css" type="text/css" charset="utf-8"/>
	<link rel="stylesheet" href="css/base.css" type="text/css" charset="utf-8"/>
	<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/broadmask/osn/broadmask.fb.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/broadmask/osn/broadmask.fb.api.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/broadmask/imageHosts/broadmask.uploader.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/ui/bootstrap.js" type="text/javascript" charset="utf-8"></script>
	<script src="js/ui/ui.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" charset="utf-8">

		// Globals
		var bg = chrome.extension.getBackgroundPage();
		var oauth = bg.oauth;
		var broadmask = bg.broadmask;

		function updateStatus() {
			$.each(bg.unread, function(key, val) {
				$("#new").empty();
				$("#new").append('<div class="newthumbs"><img class="thumb" src="'+ val + '"/><p><a class="thumbhandler" onclick="read()" href="'+ val + '" rel="' + key + '">fullsize</a></p>');
			});
		}
		chrome.extension.onRequest.addListener(
			function(request, sender, sendResponse) {
				if (request == 'updateStatus') {
					updateStatus();
				}
				sendResponse({});
			});

			$(document).ready(function() {
				fbAuth();


				// Setup bootstrap scrollspy
				$('body > .topbar').scrollspy();

				$(".thumbhandler").click(function() {
					bg.setRead($(this).attr(rel));
				});

				// Test localstorage for friendslist
				var osn = new Broadmask_facebook(document, "facebook");
				var uploader = new Broadmask_Uploader(document, "picasa", broadmask.imgHost, osn);

				updateStatus();

			});

		</script>
		<head>
			<meta charset="utf-8" />
			<title>Broadmask</title>
		</head>
		<body>
			<div id="fb-root"></div>
			<div class="navbar navbar-fixed-top">
				<div class="navbar-inner">
					<div class="container">
						<a class="brand" href="#"><span i18n>extName</span></a>
						<div class="nav-collapse">
							<ul class="nav">
								<li class="active"><a href="#">Status</a></li>
								<li><a href="#upload">Upload</a></li>
								<li><a href="#help">Help</a></li>
							</ul>
						</div><!--/.nav-collapse -->
					</div>
				</div>
			</div>
			<div class="container">
				<div class="content">
					<div class="page-header">
						<h1><span i18n>extName</span> <small><span i18n>title</span></small></h1>
					</div>
					<section id="status">
					<div class="row">
						<div class="span12">
							<div class="alert-message" id="errormsg" style="display:none">
								<a class="close" href="javascript:hideErrors()">Ã—</a>
								<div id="errors">
								</div>
							</div>
						</div>
						<div id="new"></div>
					</div>
					</section>
					<section id="#upload">
					<div class="row">
						<div id="facebook">
						</div>
					</div>
					<div class="row">				
						<div class="span10 offset1">
							<div class="row">
								<div id="picasa">
									<div class="filepicker"><input id="files-picker" type="file" multiple=""></div>
									<div id="files-dropzone" class="dropzone">or drop some files here!</div>
									<div id="files-preview"></div>
									<hr>
									<form id="share-form" class="form-horizontal">
										<div class="control-group">
											<label class="control-label" for="share-select">Share with</label>
											<div class="controls">
												<select id="share-select" disabled>
												</select>
											</div>
										</div>
										<div id="sharestatus"></div>
										<div class="form-actions">
											<a id="share-submit-btn" class="btn btn-success" disabled><i class="icon-white icon-arrow-up"></i> Share content</a>
											<a id="share-reset-btn"class="btn" disabled>Delete batch</a>
										</div>
									</form>
								</div>
							</div>
						</div>
					</div>
					</sction>
				</div>
			</div>
		</div> <!-- /container -->
		<script type="text/javascript">
			// Replace span tags with localized message
			$(document).find('*[i18n]').each(function (){
				var msg;
				var tag = $(this);
				// Replace span tag with its content
				if (tag.is('span')) {
					msg = this.innerHTML;
					tag.replaceWith(chrome.i18n.getMessage(msg));
				} else if (tag.is('input') && tag.attr('type') === 'button') {
					// Replace button value with localized message
					msg = tag.attr("value");
					tag.attr('value', chrome.i18n.getMessage(msg));
				}
				// TODO remove debug
				if (chrome.i18n.getMessage(msg) === "") {
					debug("MISSING i18n key " + msg);
				}
			});
		</script>
	</body>
</html>

