<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<title>Updates</title>
		<link rel="stylesheet" href="../css/bootstrap.css" type="text/css" charset="utf-8"/>
		<link rel="stylesheet" href="../css/app.css" type="text/css" charset="utf-8"/>
		<script src="/shared/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/jquery.watch.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/bootstrap.min.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/app.js" type="text/javascript" charset="utf-8"></script>


		<script type="text/javascript" charset="utf-8">
			var bg = chrome.extension.getBackgroundPage();
			var broadmask = bg.broadmask;

			function check_host_auth() {
				$('#picasaauthbtn').val('loading');
				broadmask.imgHost.is_authorized(function (auth_success) {
					if (auth_success === true) {
						$('#picasaauthbtn').val('Revoke Authorization')
						.removeClass('btn-success').addClass('btn-danger').attr("data-action", "logout");
						$('.picasaauth-toggle').show();
					} else {
						$('#picasaauthbtn').val('Authorize').attr("data-action", "login");
					}
				});
			}

			function check_osn_auth() {
				$('#facebookloginbtn').val('loading');
				broadmask.osn.is_authorized(function (auth_success) {
					if (auth_success === true) {
						$('#facebookloginbtn').val('Revoke Authorization')
						.removeClass('btn-success').addClass('btn-danger').attr("data-action", "logout");	
						$('.facebookauth-toggle').show();
					} else {
						$('#facebookloginbtn').val('Authorize').attr("data-action", "login");
					}
				});
			}

			$(document).ready(function () {
				check_host_auth();
				check_osn_auth();

				$('#picasaauthbtn').click(function () {
					"use strict";
					if ($(this).attr("data-action") === "logout") {
						broadmask.imgHost.revokeAuth();
						$(this).val('Authorize');
						$(this).removeClass('btn-danger').addClass('btn-success').attr("data-action", "login");
					} else {
						broadmask.imgHost.authorize(check_host_auth);
					}
				});

				$('#facebookloginbtn').click(function () {
					"use strict";
					if ($(this).attr("data-action") === "logout") {
						broadmask.osn.revokeAuth();
						$(this).val('Authorize');
						$(this).removeClass('btn-danger').addClass('btn-success').attr("data-action", "login");
					} else {
						broadmask.osn.authorize(true, check_osn_auth);
					}
				});
			});
		</script>
	</head>
	<body>
		<div id="header">
			<h1><span i18n>extName</span> <small><span i18n>title</span></small></h1>
		</div>
		<div class="container">
			<div class="row">
				<div class="span3">
					<ul id="navbar" class="nav nav-list">
						<li class="nav-header">Facebook</li>
						<li>
						<a href="upload.html"><i class="icon-camera"></i> Upload photos</a>
						</li>
						<li>
						<a href="instances.html"><i class="icon-lock"></i> Manage instances</a>
						</li>
						<li>
						<a href="users.html"><i class="icon-user"></i> Manage users</a>
						</li>
						<li class="nav-header">Broadmask</li>
						<li class="active">
						<a href="settings.html"><i class="icon-white icon-cog"></i> Settings</a>
						</li>
						<li class="divider"></li>
						<li>
						<a href="about.html"><i class="icon-info-sign"></i> About</a>
						</li>
					</ul>
				</div>
				<div id="app-content" class="span9">
					<div class="content">
						<div id="authentication">
							<div class="page-header">
								<h3>Authentication <small>Image host / OSN authentication</small></h3>
							</div>
							<div id="picasa-auth">
								<h4>Picasa Authorization</h4>
								<p>
								In order to use the Image Sharing feature, you need a Picasa Webalbums Account linked to your Google account. You can authorize BroadMask to access your Account here.<br/>
								This button will redirect you to google in order to link your account to this app.
								</p>
								<p class="picasaauth-toggle" style="display:none">
								Your picasa account has been linked and is available for Broadmask.
								</p>
								<input type="button" id="picasaauthbtn" class="btn btn-small btn-success" value="Authorize" data-loading-text="authorizing">
								<hr>
								<h4>Facebook Authorization</h4>
								<p>
								To use BroadMask services within your Facebook account, you'll need to authorize it to access your notes and friendlists.
								</p>
								<p class="facebookauth-toggle" style="display:none">
								Your facebook account has been linked and Broadmask has been authorized.
								</p>
								<input type="button" id="facebookloginbtn" class="btn btn-small btn-success" value="Authorize" data-loading-text="authorizing">
							</div>
						</div>	
						<div id="gpgkey">
							<div class="page-header">
								<h3>PGP-Key <small>Upload your PGP fingerprint to Facebook</small></h3>
							</div>
							<p>
							In order to exchange keys directly through Facebook in an automated fashion, you need to publish your PGP key identifier in your profile.<br/><span class="label label-inverse">Note</span> To create a PGP keypair, use the PGP distribution of your choice.
							</p>
							<form id="pgp-form" class="form form-horizontal">
								<fieldset>
									<div class="control-group">
										<label class="control-label" for="key-info">Currently published id</label>
										<div class="controls">
<input class="span3" id="key-info" size="24" readonly="readonly" value="None published" type="text"><button id="btn_lookup_key" class="btn btn-small" type="button" disabled>Show on Facebook</button>
											<p class="help-block light">
												This is the currently published key identifier
											</p>
										</div>
									</div>
									<div class="control-group">
										<label class="control-label" for="key-select">Your PGP-Key</label>
										<div class="controls">
											<select id="key-select" disabled>
											</select>
										</div>
									</div>
									<div class="form-actions">
										<button id="upload-key-btn" class="btn btn-success" disabled><i class="icon-white icon-arrow-up"></i> Share fingerprint</button>
										<button id="remove-key-btn"class="btn btn-inverse" disabled>Delete fingerprint</button>
									</div>
								</fieldset>
							</form>
						</div>
					</div>
				</div>
			</div>
		</body>
		<script src="../js/i18n.js" type="text/javascript" charset="utf-8"></script>
	</html>
